<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="StudyMateProject.Views.GraphicNotePage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:viewmodels="clr-namespace:StudyMateProject.ViewModels"
    xmlns:skia="clr-namespace:SkiaSharp.Views.Maui.Controls;assembly=SkiaSharp.Views.Maui.Controls"
    x:DataType="viewmodels:GraphicNoteViewModel"
    Title="{Binding Title}">

    <ContentPage.ToolbarItems>
        <ToolbarItem Text="Сохранить" Command="{Binding SaveNoteCommand}" IconImageSource="icon_save.png" />
        <ToolbarItem Text="Экспорт" IconImageSource="icon_export.png"
                 Command="{Binding ExportNoteCommand}"
                 CommandParameter="json" />
        <ToolbarItem Text="Очистить" Command="{Binding ClearStrokesCommand}" IconImageSource="icon_clear.png" />
    </ContentPage.ToolbarItems>

    <Grid RowDefinitions="Auto,Auto,*" ColumnDefinitions="*" Padding="10">
        <!-- Title Entry -->
        <Frame Grid.Row="0" Padding="5" BorderColor="{DynamicResource Primary}" CornerRadius="8">
            <Entry Placeholder="Заголовок заметки" Text="{Binding Note.Title}" FontSize="18" />
        </Frame>

        <!-- Drawing Tools -->
        <Frame Grid.Row="1" Padding="5" BorderColor="{DynamicResource Secondary}" CornerRadius="8" Margin="0,10,0,0">
            <Grid ColumnDefinitions="Auto,Auto,*,Auto,Auto" RowDefinitions="Auto">
                <!-- Color Selection -->
                <HorizontalStackLayout Grid.Column="0" Spacing="5">
                    <RadioButton Content="Черный" IsChecked="{Binding SelectedColor, Converter={StaticResource ColorConverter}, ConverterParameter='#000000'}" GroupName="Color" />
                    <RadioButton Content="Синий" IsChecked="{Binding SelectedColor, Converter={StaticResource ColorConverter}, ConverterParameter='#0000FF'}" GroupName="Color" />
                    <RadioButton Content="Красный" IsChecked="{Binding SelectedColor, Converter={StaticResource ColorConverter}, ConverterParameter='#FF0000'}" GroupName="Color" />
                    <RadioButton Content="Зеленый" IsChecked="{Binding SelectedColor, Converter={StaticResource ColorConverter}, ConverterParameter='#00FF00'}" GroupName="Color" />
                </HorizontalStackLayout>

                <!-- Tool Selection -->
                <HorizontalStackLayout Grid.Column="1" Spacing="5">
                    <RadioButton Content="Ручка" IsChecked="{Binding SelectedTool, Converter={StaticResource ToolConverter}, ConverterParameter='Pen'}" GroupName="Tool" />
                    <RadioButton Content="Маркер" IsChecked="{Binding SelectedTool, Converter={StaticResource ToolConverter}, ConverterParameter='Highlighter'}" GroupName="Tool" />
                    <RadioButton Content="Ластик" IsChecked="{Binding SelectedTool, Converter={StaticResource ToolConverter}, ConverterParameter='Eraser'}" GroupName="Tool" />
                </HorizontalStackLayout>

                <!-- Stroke Width Slider -->
                <Slider Grid.Column="2" Minimum="1" Maximum="20" Value="{Binding SelectedStrokeWidth}" />

                <!-- Width Label -->
                <Label Grid.Column="3" Text="{Binding SelectedStrokeWidth, StringFormat='Ширина: {0:F1}'}" VerticalOptions="Center" />

                <!-- Undo Button -->
                <Button Grid.Column="4" Text="Отменить" Command="{Binding UndoCommand}" />
            </Grid>
        </Frame>

        <!-- Drawing Canvas -->
        <Frame Grid.Row="2" Padding="0" BorderColor="{DynamicResource Tertiary}" CornerRadius="8" Margin="0,10,0,0">
            <skia:SKCanvasView x:Name="canvasView" 
                             PaintSurface="OnCanvasViewPaintSurface"
                             EnableTouchEvents="True"
                             Touch="OnCanvasViewTouch"
                             HorizontalOptions="FillAndExpand"
                             VerticalOptions="FillAndExpand" />
        </Frame>
    </Grid>
</ContentPage>